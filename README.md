# 学友会倉庫 予約フォーム

<img width="480" alt="image-slack" src="https://github.com/iU-Alumni-Association/rental-gas/assets/147612244/362448e7-61b5-4162-a54a-e83e1df28541">
<img width="480" alt="image-form" src="https://github.com/iU-Alumni-Association/rental-gas/assets/147612244/fa6fd7a2-3964-45b8-84dd-c0c36654d0bc">

このプロジェクトは、学友会の倉庫での物品の予約を管理するためのGoogle Apps Scriptベースのフォームを提供します。

## 機能
- ユーザーは名前、学籍番号、借りたい日付、借りる時間、返却時間、および借りる備品を入力できます。
- 入力されたデータはGoogleスプレッドシートに自動的に保存されます。
- 予約時には、特定のSlackチャンネルに通知が送られます。
- 備品リストは、別のスプレッドシートから動的に取得され、フォーム上で表示されます。

## セットアップ

1. Google Apps Scriptのプロジェクトを作成します。
2. 上記のコードをコピーしてプロジェクトに貼り付けます。
3. 必要に応じて、スプレッドシートのURLや環境変数で設定されたSlack Webhook URLを更新してください。

## 使い方

1. 予約フォームにアクセスします。
2. 必要な情報を入力します。
3. 「送信」ボタンをクリックすると、入力されたデータがスプレッドシートに保存され、Slackに通知が送信されます。
4. 「管理用リストを参照」ボタンをクリックすると、Googleスプレッドシートに直接アクセスできます。

## 注意点

- SlackのWebhook URLは環境変数で管理してください。公開されると、誰でもそのURLを使用してSlackにメッセージを送信できてしまいます。
- このフォームはGoogle Apps Scriptをベースにしているため、Googleの制限に従って動作します。

## 寄稿

このプロジェクトはオープンソースです。バグ、提案、改善点などがあれば、お気軽にIssueを立ててください。

## コードの概要

### Frontend

#### HTML

1. **Bootstrap & jQuery**: BootstrapのCSSとJSファイル、およびjQueryライブラリをインポートしています。(jQueryは使ってないかも）
   
3. **予約フォーム**: 予約に関連する情報を入力するためのフォームが設置されています。具体的には、名前、学籍番号、日付、時間、およびレンタルするアイテムに関するフィールドがあります。

4. **備品リスト**: レンタルできるアイテムの一覧を表示する部分です。データはバックエンドから動的に取得されます。

#### JavaScript

1. **addItem()**: 備品の入力フィールドを動的に追加する関数です。

2. **rmItem(btn)**: 指定されたボタンの隣接する備品の入力フィールドを削除する関数です。

3. **submitFm()**: ユーザーがフォームを送信するときに呼び出される関数です。この関数は、入力されたデータの検証、Google Apps Scriptの関数へのデータの送信、および送信後のフィードバックを行います。

4. **onSuccess()**: データが正常に送信された後に表示される成功メッセージをハンドルする関数です。

5. **isValidId(sId) & isValidName(n)**: 学籍番号と名前の形式を検証する関数です。

6. **esc(str)**: 文字列を安全にエスケープするためのユーティリティ関数です。

7. **window.onload**: この関数はページが読み込まれたときに実行され、バックエンドから利用可能なアイテムのリストを取得します。

8. **renderItemsList(items)**: 取得されたアイテムのリストをHTMLテーブルとして描画する関数です。

このフロントエンドの部分は、Bootstrapフレームワークを使用してレスポンシブデザインを持つモダンなフォームを提供しています。
また、ユーザーがフォームを簡単に使用できるように、いくつかのバリデーションとフィードバックメカニズムも組み込まれています。

### Backend (Google Apps Script)

- **doGet()**: ユーザーにHTMLページを提供するための関数。
  
- **saveData()**: ユーザーからのデータを受け取り、それをスプレッドシートに保存し、さらにSlackに通知を送る関数。
  
- **sendToSlack()**: SlackのWebhookを使用して通知を送る関数。

- **getItemsFromSheet()**: 別のスプレッドシートから備品のリストを取得する関数。

このバックエンドの部分は、Google Apps Scriptを使用して、データの保存、取得、および通知の機能を実装しています。
